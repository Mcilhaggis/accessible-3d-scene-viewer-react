{"version":3,"file":"a11y.cjs.development.js","sources":["../src/announceStore.tsx","../src/A11yConsts.tsx","../src/A11ySection.tsx","../src/Html.tsx","../src/A11y.tsx","../src/A11yUserPreferences.tsx","../src/A11yAnnouncer.tsx","../src/A11yDebuger.tsx"],"sourcesContent":["import create from 'zustand';\n\ntype State = {\n  message: string;\n  a11yScreenReader: (message: string) => void;\n};\n\nconst useAnnounceStore = create<State>((set) => {\n  return {\n    message: '',\n    a11yScreenReader: (message) => {\n      set(() => {\n        return { message: message };\n      });\n    },\n  };\n});\n\nexport default useAnnounceStore;\n","let stylesHiddenButScreenreadable = {\n  opacity: 0,\n  borderRadius: '50%',\n  width: '50px',\n  height: '50px',\n  overflow: 'hidden',\n  transform: 'translateX(-50%) translateY(-50%)',\n  display: 'inline-block',\n  userSelect: 'none' as const,\n  WebkitUserSelect: 'none' as const,\n  WebkitTouchCallout: 'none' as const,\n  margin: 0,\n};\n\nexport { stylesHiddenButScreenreadable };\n","import React, {\n  useContext,\n  useEffect,\n  useRef,\n  MutableRefObject,\n  createRef,\n} from 'react';\nimport { useThree } from '@react-three/fiber';\nimport { stylesHiddenButScreenreadable } from './A11yConsts';\n\ninterface Props {\n  children: React.ReactNode;\n  label: string;\n  description: string;\n}\n\nconst A11ySectionContext = React.createContext<\n  MutableRefObject<HTMLElement | null>\n>(createRef());\n\nA11ySectionContext.displayName = 'A11ySectionContext';\n\nconst useA11ySectionContext = () => {\n  return useContext(A11ySectionContext);\n};\n\nexport { useA11ySectionContext };\n\nexport const A11ySection: React.FC<Props> = ({\n  children,\n  label,\n  description,\n}) => {\n  const ref = useRef<HTMLElement | null>(null);\n  const refpDesc = useRef<HTMLParagraphElement | null>(null);\n  const gl = useThree((state) => state.gl);\n  const [el] = React.useState(() => document.createElement('section'));\n  const target = gl.domElement.parentNode;\n\n  useEffect(() => {\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    if (label) {\n      el.setAttribute('aria-label', label);\n    }\n    el.setAttribute('r3f-a11y', 'true');\n    el.setAttribute(\n      'style',\n      ((styles) => {\n        return Object.keys(styles).reduce(\n          (acc, key) =>\n            acc +\n            key\n              .split(/(?=[A-Z])/)\n              .join('-')\n              .toLowerCase() +\n            ':' +\n            (styles as any)[key] +\n            ';',\n          ''\n        );\n      })(stylesHiddenButScreenreadable)\n    );\n    if (description) {\n      if (refpDesc.current === null) {\n        const pDesc = document.createElement('p');\n        pDesc.innerHTML = description;\n        pDesc.style.cssText =\n          'border: 0!important;clip: rect(1px,1px,1px,1px)!important;-webkit-clip-path: inset(50%)!important;clip-path: inset(50%)!important;height: 1px!important;margin: -1px!important;overflow: hidden!important;padding: 0!important;position: absolute!important;width: 1px!important;white-space: nowrap!important;';\n        el.prepend(pDesc);\n        refpDesc.current = pDesc;\n      } else {\n        refpDesc.current.innerHTML = description;\n      }\n    }\n    return () => {\n      if (target) target.removeChild(el);\n    };\n  }, [description, label]);\n\n  if (ref.current === null) {\n    if (target) {\n      target.appendChild(el);\n    }\n    ref.current = el;\n  }\n\n  return (\n    <>\n      <A11ySectionContext.Provider value={ref}>\n        {children}\n      </A11ySectionContext.Provider>\n    </>\n  );\n};\n","//https://raw.githubusercontent.com/pmndrs/drei/master/src/web/Html.tsx\nimport * as React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport {\n  Vector3,\n  Group,\n  Object3D,\n  Camera,\n  PerspectiveCamera,\n  OrthographicCamera,\n} from 'three';\nimport { Assign } from 'utility-types';\nimport { ReactThreeFiber, useFrame, useThree } from '@react-three/fiber';\n\nconst v1 = new Vector3();\nconst v2 = new Vector3();\nconst v3 = new Vector3();\n\nfunction calculatePosition(\n  el: Object3D,\n  camera: Camera,\n  size: { width: number; height: number }\n) {\n  const objectPos = v1.setFromMatrixPosition(el.matrixWorld);\n  objectPos.project(camera);\n  const widthHalf = size.width / 2;\n  const heightHalf = size.height / 2;\n  return [\n    objectPos.x * widthHalf + widthHalf,\n    -(objectPos.y * heightHalf) + heightHalf,\n  ];\n}\n\nfunction isObjectBehindCamera(el: Object3D, camera: Camera) {\n  const objectPos = v1.setFromMatrixPosition(el.matrixWorld);\n  const cameraPos = v2.setFromMatrixPosition(camera.matrixWorld);\n  const deltaCamObj = objectPos.sub(cameraPos);\n  const camDir = camera.getWorldDirection(v3);\n  return deltaCamObj.angleTo(camDir) > Math.PI / 2;\n}\n\nfunction objectZIndex(\n  el: Object3D,\n  camera: Camera,\n  zIndexRange: Array<number>\n) {\n  if (\n    camera instanceof PerspectiveCamera ||\n    camera instanceof OrthographicCamera\n  ) {\n    const objectPos = v1.setFromMatrixPosition(el.matrixWorld);\n    const cameraPos = v2.setFromMatrixPosition(camera.matrixWorld);\n    const dist = objectPos.distanceTo(cameraPos);\n    const A = (zIndexRange[1] - zIndexRange[0]) / (camera.far - camera.near);\n    const B = zIndexRange[1] - A * camera.far;\n    return Math.round(A * dist + B);\n  }\n  return undefined;\n}\n\nexport interface HtmlProps\n  extends Omit<\n    Assign<\n      React.HTMLAttributes<HTMLDivElement>,\n      ReactThreeFiber.Object3DNode<Group, typeof Group>\n    >,\n    'ref'\n  > {\n  eps?: number;\n  portal?: React.MutableRefObject<HTMLElement>;\n  zIndexRange?: Array<number>;\n}\n\nexport const Html = React.forwardRef(\n  (\n    {\n      children,\n      eps = 0.001,\n      style,\n      className,\n      portal,\n      zIndexRange = [16777271, 0],\n      ...props\n    }: HtmlProps,\n    ref: React.Ref<HTMLDivElement>\n  ) => {\n    const gl = useThree(({ gl }) => gl);\n    const camera = useThree(({ camera }) => camera);\n    const scene = useThree(({ scene }) => scene);\n    const size = useThree(({ size }) => size);\n    const [el] = React.useState(() => document.createElement('div'));\n    const root = React.useMemo(() => ReactDOM.createRoot(el), [el]);\n    const group = React.useRef<Group>(null);\n    const oldZoom = React.useRef(0);\n    const oldPosition = React.useRef([0, 0]);\n    const target = portal?.current ?? gl.domElement.parentNode;\n\n    React.useEffect(() => {\n      if (group.current) {\n        scene.updateMatrixWorld();\n        const vec = calculatePosition(group.current, camera, size);\n        el.style.cssText = `position:absolute;top:0;left:0;transform:translate3d(${vec[0]}px,${vec[1]}px,0);transform-origin:0 0;`;\n        if (target) {\n          target.appendChild(el);\n        }\n        return () => {\n          if (target) target.removeChild(el);\n          root.unmount();\n        };\n      }\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [target]);\n\n    const styles: React.CSSProperties = React.useMemo(() => {\n      return {\n        position: 'absolute',\n        transform: 'none',\n        ...style,\n      };\n    }, [style, size]);\n\n    React.useLayoutEffect(() => {\n      root.render(\n        <div\n          ref={ref}\n          style={styles}\n          className={className}\n          children={children}\n        />\n      );\n    });\n\n    useFrame(() => {\n      if (group.current) {\n        camera.updateMatrixWorld();\n        const vec = calculatePosition(group.current, camera, size);\n\n        if (\n          Math.abs(oldZoom.current - camera.zoom) > eps ||\n          Math.abs(oldPosition.current[0] - vec[0]) > eps ||\n          Math.abs(oldPosition.current[1] - vec[1]) > eps\n        ) {\n          el.style.display = !isObjectBehindCamera(group.current, camera)\n            ? 'block'\n            : 'none';\n          el.style.zIndex = `${objectZIndex(\n            group.current,\n            camera,\n            zIndexRange\n          )}`;\n          el.style.transform = `translate3d(${vec[0]}px,${vec[1]}px,0) scale(1)`;\n          oldPosition.current = vec;\n          oldZoom.current = camera.zoom;\n        }\n      }\n    });\n\n    return <group {...props} ref={group} />;\n  }\n);\n","import React, { useEffect, useRef, useState, useContext } from 'react';\nimport { useThree } from '@react-three/fiber';\nimport useAnnounceStore from './announceStore';\nimport { useA11ySectionContext } from './A11ySection';\nimport { stylesHiddenButScreenreadable } from './A11yConsts';\nimport { Html } from './Html';\n\ninterface A11yCommonProps {\n  role: 'button' | 'togglebutton' | 'link' | 'content' | 'image';\n  children: React.ReactNode;\n  description: string;\n  tabIndex?: number;\n  showAltText?: boolean;\n  focusCall?: (...args: any[]) => any;\n  debug?: boolean;\n  a11yElStyle?: Object;\n  hidden?: boolean;\n  dragThreshold?: number;\n}\n\ntype RoleProps =\n  | {\n      role: 'content';\n      activationMsg?: never;\n      deactivationMsg?: never;\n      actionCall?: never;\n      href?: never;\n      disabled?: never;\n      startPressed?: never;\n      tag?: 'p' | 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6';\n    }\n  | {\n      role: 'button';\n      activationMsg?: string;\n      deactivationMsg?: never;\n      actionCall?: () => any;\n      href?: never;\n      disabled?: boolean;\n      startPressed?: never;\n      tag?: never;\n    }\n  | {\n      role: 'togglebutton';\n      activationMsg?: string;\n      deactivationMsg?: string;\n      actionCall?: () => any;\n      href?: never;\n      disabled?: boolean;\n      startPressed?: boolean;\n      tag?: never;\n    }\n  | {\n      role: 'link';\n      activationMsg?: never;\n      deactivationMsg?: never;\n      actionCall: () => any;\n      href: string;\n      disabled?: never;\n      startPressed?: never;\n      tag?: never;\n    }\n  | {\n      role: 'image';\n      activationMsg?: never;\n      deactivationMsg?: never;\n      actionCall?: never;\n      href?: never;\n      disabled?: never;\n      startPressed?: never;\n      tag?: never;\n    };\n\ntype Props = A11yCommonProps & RoleProps;\n\nconst A11yContext = React.createContext({\n  focus: false,\n  hover: false,\n  pressed: false,\n});\n\nA11yContext.displayName = 'A11yContext';\n\nconst useA11y = () => {\n  return useContext(A11yContext);\n};\n\nexport { useA11y };\n\nexport const A11y: React.FC<Props> = ({\n  children,\n  description,\n  activationMsg,\n  deactivationMsg,\n  tabIndex,\n  href,\n  role,\n  showAltText = false,\n  actionCall,\n  focusCall,\n  disabled,\n  debug = false,\n  a11yElStyle,\n  startPressed = false,\n  tag = 'p',\n  hidden = false,\n  dragThreshold,\n  ...props\n}) => {\n  let constHiddenButScreenreadable = Object.assign(\n    {},\n    stylesHiddenButScreenreadable,\n    { opacity: debug ? 1 : 0 },\n    a11yElStyle\n  );\n\n  const [a11yState, setA11yState] = useState({\n    hovered: false,\n    focused: false,\n    pressed: startPressed ? startPressed : false,\n  });\n\n  const a11yScreenReader = useAnnounceStore((state) => state.a11yScreenReader);\n\n  const overHtml = useRef(false);\n  const overMesh = useRef(false);\n\n  const domElement = useThree((state) => state.gl.domElement);\n\n  // temporary fix to prevent error -> keep track of our component's mounted state\n  const componentIsMounted = useRef(true);\n  useEffect(() => {\n    return () => {\n      domElement.style.cursor = 'default';\n      componentIsMounted.current = false;\n    };\n  }, []); // Using an empty dependency array ensures this on\n\n  React.Children.only(children);\n  // @ts-ignore\n  const handleOnPointerOver = (e) => {\n    if (e.eventObject) {\n      overMesh.current = true;\n    } else {\n      overHtml.current = true;\n    }\n    if (overHtml.current || overMesh.current) {\n      if (role !== 'content' && role !== 'image' && !disabled) {\n        domElement.style.cursor = 'pointer';\n      }\n      setA11yState({\n        hovered: true,\n        focused: a11yState.focused,\n        pressed: a11yState.pressed,\n      });\n    }\n  };\n  // @ts-ignore\n  const handleOnPointerOut = (e) => {\n    if (e.eventObject) {\n      overMesh.current = false;\n    } else {\n      overHtml.current = false;\n    }\n    if (!overHtml.current && !overMesh.current) {\n      if (componentIsMounted.current) {\n        domElement.style.cursor = 'default';\n        setA11yState({\n          hovered: false,\n          focused: a11yState.focused,\n          pressed: a11yState.pressed,\n        });\n      }\n    }\n  };\n\n  function handleBtnClick() {\n    //msg is the same need to be clean for it to trigger again in case of multiple press in a row\n    a11yScreenReader('');\n    window.setTimeout(() => {\n      if (typeof activationMsg === 'string') a11yScreenReader(activationMsg);\n    }, 100);\n    if (typeof actionCall === 'function') actionCall();\n  }\n\n  function handleToggleBtnClick() {\n    if (a11yState.pressed) {\n      if (typeof deactivationMsg === 'string')\n        a11yScreenReader(deactivationMsg);\n    } else {\n      if (typeof activationMsg === 'string') a11yScreenReader(activationMsg);\n    }\n    setA11yState({\n      hovered: a11yState.hovered,\n      focused: a11yState.focused,\n      pressed: !a11yState.pressed,\n    });\n    if (typeof actionCall === 'function') actionCall();\n  }\n\n  const returnHtmlA11yEl = () => {\n    if (role === 'button' || role === 'togglebutton') {\n      let disabledBtnAttr = disabled\n        ? {\n            disabled: true,\n          }\n        : null;\n      if (role === 'togglebutton') {\n        return (\n          <button\n            r3f-a11y=\"true\"\n            {...disabledBtnAttr}\n            aria-pressed={a11yState.pressed ? 'true' : 'false'}\n            tabIndex={tabIndex ? tabIndex : 0}\n            style={Object.assign(\n              constHiddenButScreenreadable,\n              disabled ? { cursor: 'default' } : { cursor: 'pointer' },\n              hidden\n                ? { visibility: 'hidden' as const }\n                : { visibility: 'visible' as const }\n            )}\n            onPointerOver={handleOnPointerOver}\n            onPointerOut={handleOnPointerOut}\n            onClick={(e) => {\n              e.stopPropagation();\n              if (disabled) {\n                return;\n              }\n              handleToggleBtnClick();\n            }}\n            onFocus={() => {\n              if (typeof focusCall === 'function') focusCall();\n              setA11yState({\n                hovered: a11yState.hovered,\n                focused: true,\n                pressed: a11yState.pressed,\n              });\n            }}\n            onBlur={() => {\n              setA11yState({\n                hovered: a11yState.hovered,\n                focused: false,\n                pressed: a11yState.pressed,\n              });\n            }}\n          >\n            {description}\n          </button>\n        );\n      } else {\n        //regular btn\n        return (\n          <button\n            r3f-a11y=\"true\"\n            {...disabledBtnAttr}\n            tabIndex={tabIndex ? tabIndex : 0}\n            style={Object.assign(\n              constHiddenButScreenreadable,\n              disabled ? { cursor: 'default' } : { cursor: 'pointer' },\n              hidden\n                ? { visibility: 'hidden' as const }\n                : { visibility: 'visible' as const }\n            )}\n            onPointerOver={handleOnPointerOver}\n            onPointerOut={handleOnPointerOut}\n            onClick={(e) => {\n              e.stopPropagation();\n              if (disabled) {\n                return;\n              }\n              handleBtnClick();\n            }}\n            onFocus={() => {\n              if (typeof focusCall === 'function') focusCall();\n              setA11yState({\n                hovered: a11yState.hovered,\n                focused: true,\n                pressed: a11yState.pressed,\n              });\n            }}\n            onBlur={() => {\n              setA11yState({\n                hovered: a11yState.hovered,\n                focused: false,\n                pressed: a11yState.pressed,\n              });\n            }}\n          >\n            {description}\n          </button>\n        );\n      }\n    } else if (role === 'link') {\n      return (\n        <a\n          r3f-a11y=\"true\"\n          style={Object.assign(\n            constHiddenButScreenreadable,\n            hidden\n              ? { visibility: 'hidden' as const }\n              : { visibility: 'visible' as const }\n          )}\n          href={href}\n          onPointerOver={handleOnPointerOver}\n          onPointerOut={handleOnPointerOut}\n          onClick={(e) => {\n            e.stopPropagation();\n            e.preventDefault();\n            if (typeof actionCall === 'function') actionCall();\n          }}\n          onFocus={() => {\n            if (typeof focusCall === 'function') focusCall();\n            setA11yState({\n              hovered: a11yState.hovered,\n              focused: true,\n              pressed: a11yState.pressed,\n            });\n          }}\n          onBlur={() => {\n            setA11yState({\n              hovered: a11yState.hovered,\n              focused: false,\n              pressed: a11yState.pressed,\n            });\n          }}\n        >\n          {description}\n        </a>\n      );\n    } else {\n      let tabIndexP = tabIndex\n        ? {\n            tabIndex: tabIndex,\n          }\n        : null;\n      if (role === 'image') {\n        return (\n          <img\n            r3f-a11y=\"true\"\n            src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E\"\n            alt={description}\n            {...tabIndexP}\n            style={Object.assign(\n              constHiddenButScreenreadable,\n              hidden\n                ? { visibility: 'hidden' as const }\n                : { visibility: 'visible' as const }\n            )}\n            onPointerOver={handleOnPointerOver}\n            onPointerOut={handleOnPointerOut}\n            onBlur={() => {\n              setA11yState({\n                hovered: a11yState.hovered,\n                focused: false,\n                pressed: a11yState.pressed,\n              });\n            }}\n            onFocus={() => {\n              if (typeof focusCall === 'function') focusCall();\n              setA11yState({\n                hovered: a11yState.hovered,\n                focused: true,\n                pressed: a11yState.pressed,\n              });\n            }}\n          />\n        );\n      } else {\n        const Tag = tag;\n        return (\n          <Tag\n            r3f-a11y=\"true\"\n            {...tabIndexP}\n            style={Object.assign(\n              constHiddenButScreenreadable,\n              hidden\n                ? { visibility: 'hidden' as const }\n                : { visibility: 'visible' as const }\n            )}\n            onPointerOver={handleOnPointerOver}\n            onPointerOut={handleOnPointerOut}\n            onBlur={() => {\n              setA11yState({\n                hovered: a11yState.hovered,\n                focused: false,\n                pressed: a11yState.pressed,\n              });\n            }}\n            onFocus={() => {\n              if (typeof focusCall === 'function') focusCall();\n              setA11yState({\n                hovered: a11yState.hovered,\n                focused: true,\n                pressed: a11yState.pressed,\n              });\n            }}\n          >\n            {description}\n          </Tag>\n        );\n      }\n    }\n  };\n\n  const HtmlAccessibleElement = React.useMemo(returnHtmlA11yEl, [\n    description,\n    a11yState,\n    hidden,\n    tabIndex,\n    href,\n    disabled,\n    startPressed,\n    tag,\n    actionCall,\n    focusCall,\n  ]);\n\n  let AltText = null;\n  if (showAltText && a11yState.hovered) {\n    AltText = (\n      <div\n        aria-hidden={true}\n        style={{\n          width: 'auto',\n          maxWidth: '300px',\n          display: 'block',\n          position: 'absolute',\n          top: '0px',\n          left: '0px',\n          transform: 'translate(-50%,-50%)',\n          background: 'white',\n          borderRadius: '4px',\n          padding: '4px',\n        }}\n      >\n        <p\n          aria-hidden={true}\n          style={{\n            margin: '0px',\n          }}\n        >\n          {description}\n        </p>\n      </div>\n    );\n  }\n\n  const section = useA11ySectionContext();\n  let portal = {};\n  if (section.current instanceof HTMLElement) {\n    portal = { portal: section };\n  }\n\n  return (\n    <A11yContext.Provider\n      value={{\n        hover: a11yState.hovered,\n        focus: a11yState.focused,\n        pressed: a11yState.pressed,\n      }}\n    >\n      <group\n        {...props}\n        onClick={(e) => {\n          e.stopPropagation();\n          if (disabled || (dragThreshold && e.delta > dragThreshold)) {\n            return;\n          }\n          if (role === 'button') {\n            handleBtnClick();\n          } else if (role === 'togglebutton') {\n            handleToggleBtnClick();\n          } else {\n            if (typeof actionCall === 'function') actionCall();\n          }\n        }}\n        onPointerOver={handleOnPointerOver}\n        onPointerOut={handleOnPointerOut}\n      >\n        {children}\n        <Html\n          style={{ width: '0px' }}\n          position={\n            // @ts-ignore\n            children.props.position ? children.props.position : 0\n          }\n          {...portal}\n        >\n          {AltText}\n          {HtmlAccessibleElement}\n        </Html>\n      </group>\n    </A11yContext.Provider>\n  );\n};\n","import React, { useEffect, useState, useContext } from 'react';\ninterface Props {\n  children: React.ReactNode;\n}\n\ntype aasetA11yPrefersState = {\n  prefersReducedMotion: boolean;\n  prefersDarkScheme: boolean;\n};\n\nconst A11yUserPreferencesContext = React.createContext({\n  a11yPrefersState: {\n    prefersReducedMotion: false,\n    prefersDarkScheme: false,\n  },\n  // tslint:disable:no-unused-variable\n  setA11yPrefersState: (_state: aasetA11yPrefersState) => {},\n  // tslint:enable:no-unused-variable\n});\n\nA11yUserPreferencesContext.displayName = 'A11yUserPreferencesContext';\n\nconst useUserPreferences = () => {\n  return useContext(A11yUserPreferencesContext);\n};\n\nexport { useUserPreferences, A11yUserPreferencesContext };\n\nexport const A11yUserPreferences: React.FC<Props> = ({ children }) => {\n  const [a11yPrefersState, setA11yPrefersState] = useState({\n    prefersReducedMotion: false,\n    prefersDarkScheme: false,\n  });\n\n  useEffect(() => {\n    const prefersReducedMotionMediaQuery = window.matchMedia(\n      '(prefers-reduced-motion: reduce)'\n    );\n    const prefersDarkSchemeMediaQuery = window.matchMedia(\n      '(prefers-color-scheme: dark)'\n    );\n\n    setA11yPrefersState({\n      prefersReducedMotion: prefersReducedMotionMediaQuery.matches,\n      prefersDarkScheme: prefersDarkSchemeMediaQuery.matches,\n    });\n\n    const handleReducedMotionPrefChange = (e: MediaQueryListEvent) => {\n      setA11yPrefersState({\n        prefersReducedMotion: e.matches,\n        prefersDarkScheme: prefersDarkSchemeMediaQuery.matches,\n      });\n    };\n    const handleDarkSchemePrefChange = (e: MediaQueryListEvent) => {\n      setA11yPrefersState({\n        prefersReducedMotion: prefersReducedMotionMediaQuery.matches,\n        prefersDarkScheme: e.matches,\n      });\n    };\n\n    if (typeof prefersReducedMotionMediaQuery.addEventListener === 'function') {\n      prefersReducedMotionMediaQuery.addEventListener(\n        'change',\n        handleReducedMotionPrefChange\n      );\n    }\n    if (typeof prefersDarkSchemeMediaQuery.addEventListener === 'function') {\n      prefersDarkSchemeMediaQuery.addEventListener(\n        'change',\n        handleDarkSchemePrefChange\n      );\n    }\n    return () => {\n      if (\n        typeof prefersReducedMotionMediaQuery.removeEventListener === 'function'\n      ) {\n        prefersReducedMotionMediaQuery.removeEventListener(\n          'change',\n          handleReducedMotionPrefChange\n        );\n      }\n      if (\n        typeof prefersDarkSchemeMediaQuery.removeEventListener === 'function'\n      ) {\n        prefersDarkSchemeMediaQuery.removeEventListener(\n          'change',\n          handleDarkSchemePrefChange\n        );\n      }\n    };\n  }, []);\n\n  return (\n    <A11yUserPreferencesContext.Provider\n      value={{\n        a11yPrefersState: {\n          prefersReducedMotion: a11yPrefersState.prefersReducedMotion,\n          prefersDarkScheme: a11yPrefersState.prefersDarkScheme,\n        },\n        setA11yPrefersState: setA11yPrefersState,\n      }}\n    >\n      {children}\n    </A11yUserPreferencesContext.Provider>\n  );\n};\n","import React, { useEffect } from 'react';\nimport useAnnounceStore from './announceStore';\n\nconst offScreenStyle = {\n  border: 0,\n  clip: 'rect(0 0 0 0)',\n  height: '1px',\n  margin: '-1px',\n  overflow: 'hidden',\n  whiteSpace: 'nowrap' as const,\n  padding: 0,\n  width: '1px',\n  position: 'absolute' as const,\n};\n\nexport const A11yAnnouncer: React.FC = () => {\n  const message = useAnnounceStore((state) => state.message);\n\n  useEffect(() => {\n    const mouseClickListener = (e: MouseEvent) => {\n      if (\n        window.document.activeElement?.getAttribute('r3f-a11y') &&\n        e.detail !== 0\n      ) {\n        if (window.document.activeElement instanceof HTMLElement) {\n          window.document.activeElement.blur();\n        }\n      }\n    };\n    window.addEventListener('click', mouseClickListener);\n    return () => {\n      window.removeEventListener('click', mouseClickListener);\n    };\n  });\n\n  return (\n    <div style={offScreenStyle} aria-atomic=\"true\" aria-live=\"polite\">\n      {message}\n    </div>\n  );\n};\n","import React, { useLayoutEffect, useEffect, useState, useRef } from 'react';\nimport ReactDOM from 'react-dom/client';\nimport { useUserPreferences } from './A11yUserPreferences';\ninterface Props {}\n\nexport const A11yDebuger: React.FC<Props> = ({}) => {\n  const [el] = useState(() => document.createElement('div'));\n  const root = React.useMemo(() => ReactDOM.createRoot(el), [el]);\n  const [boundingStyle, setBoundingStyle] = useState({});\n  const [debugState, setDebugState] = useState({\n    prefersDarkScheme: false,\n    prefersReducedMotion: false,\n  });\n  const { a11yPrefersState, setA11yPrefersState } = useUserPreferences();\n  const domStructureRef = useRef(null);\n\n  useEffect(() => {\n    el.style.cssText = 'position:fixed;top:0;left:0;';\n    el.setAttribute('aria-hidden', 'true');\n    document.body.appendChild(el);\n    setDebugState({\n      prefersDarkScheme: a11yPrefersState.prefersDarkScheme,\n      prefersReducedMotion: a11yPrefersState.prefersReducedMotion,\n    });\n    const selectActiveEl = () => {\n      console.log('focused: ', document.activeElement);\n      let r3fa11ydebugidref = document.activeElement?.getAttribute(\n        'r3f-a11y-debug-id'\n      );\n      if (r3fa11ydebugidref) {\n        document.querySelectorAll('[r3fa11ydebugidref]').forEach((node) => {\n          //@ts-ignore\n          node.style.color = null;\n        });\n        let refEl = document.querySelector(\n          '[r3fa11ydebugidref=\"' + r3fa11ydebugidref + '\"]'\n        );\n        if (refEl) {\n          //@ts-ignore\n          refEl.style.color = 'red';\n        }\n      }\n    };\n    //@ts-ignore\n    const root = ReactDOM.createRoot(domStructureRef.current);\n    console.log('enregistre ev');\n    document.addEventListener('focus', selectActiveEl, true);\n    let superinterval = window.setInterval(() => {\n      let r3fPosId = 0;\n      //@ts-ignore\n      let elements = [];\n      document.querySelectorAll('[r3f-a11y]').forEach((node) => {\n        node.setAttribute('r3f-a11y-debug-id', '' + r3fPosId);\n        // let li = document.createElement('li');\n        // li.innerHTML = node.tagName ;\n        // //@ts-ignore\n        // domStructureRef.current.appendChild(li);\n        elements.push(\n          //@ts-ignore\n          <li key={r3fPosId} r3fa11ydebugidref={r3fPosId}>\n            {node.tagName}\n            <button\n              tabIndex={-1}\n              onClick={() => {\n                console.log(node);\n                let clientRect = node.getBoundingClientRect();\n                setBoundingStyle({\n                  width: clientRect.width,\n                  height: clientRect.height,\n                  top: clientRect.top,\n                  left: clientRect.left,\n                });\n              }}\n            >\n              Show\n            </button>\n          </li>\n        );\n        r3fPosId++;\n      });\n      //@ts-ignore\n      root.render(<>{elements}</>);\n    }, 2000);\n    return () => {\n      clearInterval(superinterval);\n      root.unmount();\n      console.log('remove ev');\n      document.removeEventListener('focus', selectActiveEl, true);\n    };\n  }, [a11yPrefersState]);\n\n  // @ts-ignore\n  const handleChange = (e) => {\n    // @ts-ignore\n    setA11yPrefersState({\n      prefersDarkScheme:\n        e.target.name === 'prefersDarkScheme'\n          ? e.target.checked\n          : debugState.prefersDarkScheme,\n      prefersReducedMotion:\n        e.target.name === 'prefersReducedMotion'\n          ? e.target.checked\n          : debugState.prefersReducedMotion,\n    });\n  };\n\n  useLayoutEffect(() => {\n    return void root.render(\n      <>\n        <label>\n          Prefer dark mode\n          <input\n            type=\"checkbox\"\n            name=\"prefersDarkScheme\"\n            checked={debugState.prefersDarkScheme}\n            onChange={handleChange}\n          />\n        </label>\n        <label>\n          Prefer reduced motion\n          <input\n            type=\"checkbox\"\n            name=\"prefersReducedMotion\"\n            checked={debugState.prefersReducedMotion}\n            onChange={handleChange}\n          />\n        </label>\n        <h3>R3F Dom order</h3>\n        <ul ref={domStructureRef}></ul>\n        <div\n          style={Object.assign(\n            {\n              position: 'absolute' as const,\n              border: '1px solid white',\n              borderRadius: '50%',\n              background:\n                'linear-gradient( 45deg, rgb(70, 255, 60, 0.7), rgb(0, 64, 193, 0.7))',\n              pointerEvents: 'none' as const,\n              transition: 'all 200ms ease',\n            },\n            boundingStyle\n          )}\n        ></div>\n      </>\n    );\n  });\n\n  return <></>;\n};\n"],"names":["useAnnounceStore","create","set","message","a11yScreenReader","stylesHiddenButScreenreadable","opacity","borderRadius","width","height","overflow","transform","display","userSelect","WebkitUserSelect","WebkitTouchCallout","margin","A11ySectionContext","React","createContext","createRef","displayName","useA11ySectionContext","useContext","A11ySection","children","label","description","ref","useRef","refpDesc","gl","useThree","state","useState","document","createElement","el","target","domElement","parentNode","useEffect","setAttribute","styles","Object","keys","reduce","acc","key","split","join","toLowerCase","current","pDesc","innerHTML","style","cssText","prepend","removeChild","appendChild","Provider","value","v1","Vector3","v2","v3","calculatePosition","camera","size","objectPos","setFromMatrixPosition","matrixWorld","project","widthHalf","heightHalf","x","y","isObjectBehindCamera","cameraPos","deltaCamObj","sub","camDir","getWorldDirection","angleTo","Math","PI","objectZIndex","zIndexRange","PerspectiveCamera","OrthographicCamera","dist","distanceTo","A","far","near","B","round","undefined","Html","eps","className","portal","props","scene","root","ReactDOM","createRoot","group","oldZoom","oldPosition","updateMatrixWorld","vec","unmount","position","render","useFrame","abs","zoom","zIndex","A11yContext","focus","hover","pressed","useA11y","A11y","activationMsg","deactivationMsg","tabIndex","href","role","showAltText","actionCall","focusCall","disabled","debug","a11yElStyle","startPressed","tag","hidden","dragThreshold","constHiddenButScreenreadable","assign","hovered","focused","a11yState","setA11yState","overHtml","overMesh","componentIsMounted","cursor","Children","only","handleOnPointerOver","e","eventObject","handleOnPointerOut","handleBtnClick","window","setTimeout","handleToggleBtnClick","returnHtmlA11yEl","disabledBtnAttr","visibility","onPointerOver","onPointerOut","onClick","stopPropagation","onFocus","onBlur","preventDefault","tabIndexP","src","alt","Tag","HtmlAccessibleElement","useMemo","AltText","maxWidth","top","left","background","padding","section","HTMLElement","delta","A11yUserPreferencesContext","a11yPrefersState","prefersReducedMotion","prefersDarkScheme","setA11yPrefersState","_state","useUserPreferences","A11yUserPreferences","prefersReducedMotionMediaQuery","matchMedia","prefersDarkSchemeMediaQuery","matches","handleReducedMotionPrefChange","handleDarkSchemePrefChange","addEventListener","removeEventListener","offScreenStyle","border","clip","whiteSpace","A11yAnnouncer","mouseClickListener","activeElement","getAttribute","detail","blur","A11yDebuger","boundingStyle","setBoundingStyle","debugState","setDebugState","domStructureRef","body","selectActiveEl","console","log","r3fa11ydebugidref","querySelectorAll","forEach","node","color","refEl","querySelector","superinterval","setInterval","r3fPosId","elements","push","tagName","clientRect","getBoundingClientRect","clearInterval","handleChange","name","checked","useLayoutEffect","type","onChange","pointerEvents","transition"],"mappings":"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"}